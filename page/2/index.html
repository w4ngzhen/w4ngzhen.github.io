<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.1.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.ico">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"compilemind.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.json"};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="CompileMind">
<meta property="og:url" content="http://compilemind.com/page/2/index.html">
<meta property="og:site_name" content="CompileMind">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="w4ngzhen">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://compilemind.com/page/2/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'en'
  };
</script>

  <title>CompileMind</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">CompileMind</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>Archives</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>About</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>Tags</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://compilemind.com/2020/02/05/2020-02-05-WinForm%E4%BA%8B%E4%BB%B6%E4%B8%8E%E6%B6%88%E6%81%AF/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="w4ngzhen">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CompileMind">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/02/05/2020-02-05-WinForm%E4%BA%8B%E4%BB%B6%E4%B8%8E%E6%B6%88%E6%81%AF/" class="post-title-link" itemprop="url">WinForm事件与消息</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-02-05 00:00:00" itemprop="dateCreated datePublished" datetime="2020-02-05T00:00:00+08:00">2020-02-05</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-10-13 15:20:30" itemprop="dateModified" datetime="2020-10-13T15:20:30+08:00">2020-10-13</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="消息概述以及在C-下的封装"><a href="#消息概述以及在C-下的封装" class="headerlink" title="消息概述以及在C#下的封装"></a>消息概述以及在C#下的封装</h3><p>Windows下应用程序的执行是通过消息驱动的。所有的外部事件，如键盘输入、鼠标移动、按动鼠标都由OS系统转换成相应的“消息”，进入到应用程序的消息队列中，由应用程序引擎轮询处理。在C#中，消息被应用程序的工作引擎通过轮询等方式遍历获取并按照消息的类型逐个分发到对应的组件（例如窗体、按钮等），最后调用对应组件所注册的事件进行处理。</p>
<p>在.NET框架类库中的System.Windows.Forms命名空间中微软采用面对对象的方式重新定义了Message。该消息主要有一下的几个公共属性：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">System.Windows.Forms.Message</span><br><span class="line">HWnd     获取或设定消息的处理函数</span><br><span class="line">Msg      获取或设定消息的ID号</span><br><span class="line">Lparam   指定消息的LParam字段</span><br><span class="line">Wparam   指定消息的WParam字段</span><br><span class="line">Result   指定为响应消息处理函数而向OS系统返回的值</span><br></pre></td></tr></table></figure>
<h3 id="System-Windows-Forms-Application"><a href="#System-Windows-Forms-Application" class="headerlink" title="System.Windows.Forms.Application"></a>System.Windows.Forms.Application</h3><p>System.Windows.Forms.Application类具有用于启动和停止应用程序和线程以及处理Windows消息的方法。例如，调用Run以启动当前线程上的应用程序消息循环，并可以选择使其窗体可见；调用Exit或ExitThread来停止消息循环。所以我们经常使用vs初始化一个基本的WinForm程序，显示的下列模板代码：<br><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 应用程序的主入口点。</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">[<span class="meta">STAThread</span>]</span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Application.EnableVisualStyles();</span><br><span class="line">    Application.SetCompatibleTextRenderingDefault(<span class="literal">false</span>);</span><br><span class="line">    Application.Run(<span class="keyword">new</span> Form1()); <span class="comment">// 调用Run以启动当前线程上的应用程序消息循环</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>因为Application是在单线程中运行的，所以在Application.Run开始后，Application本身不断轮询检查消息队列，然后根据消息类型进行数据分发。例如，当我们为这个Form1增加一个鼠标的点击事件后，我们运行该打开Form1：<br><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Form1 form1 = <span class="keyword">new</span> Form1();</span><br><span class="line">form1.MouseClick += (sender, e) =&gt; MessageBox.Show(<span class="string">&quot;1&quot;</span>);</span><br><span class="line">form1.MouseClick += (sender, e) =&gt; MessageBox.Show(<span class="string">&quot;2&quot;</span>);</span><br><span class="line">Application.Run(form1);</span><br></pre></td></tr></table></figure><br>运行后点击Form，可以看到首先出现一个MessageBox，展示“1”，我们点击确定后，又会出现MessageBox，展示“2”。实际上整个过程应该如下：</p>
<p>当我们按下鼠标左键后，消息形成并送往应用程序消息队列中，然后被Application类从应用程序消息队列中取出，然后分发到相应的窗体。窗体使用MouseClick事件中的函数指针调用已经添加的响应函数。所以C#中的事件字段实质上是一个函数指针列表，用来维护一些消息到达时的响应函数的地址。</p>
<p>到目前为止我们可以看到，消息其实在我们进行事件调用的时候，已经被提取加工了，它已经由Application进行了预处理，形成了所谓的“事件调用”。那么，我们还能更加自定义的干预消息吗？答案是可以的。</p>
<h3 id="WndProc"><a href="#WndProc" class="headerlink" title="WndProc"></a>WndProc</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;</span><br><span class="line"> &#x2F;&#x2F; 摘要:</span><br><span class="line">&#x2F;&#x2F;     处理 Windows 消息。</span><br><span class="line">&#x2F;&#x2F;</span><br><span class="line">&#x2F;&#x2F; 参数:</span><br><span class="line">&#x2F;&#x2F;   m:</span><br><span class="line">&#x2F;&#x2F;     要处理的 Windows System.Windows.Forms.Message。</span><br><span class="line">protected override void WndProc(ref System.Windows.Forms.Message e);</span><br></pre></td></tr></table></figure>
<p>对于每个Form来说，我们都可以重写该方法，该方法的参数就是上面提到的Message类的实例，所有的消息在被获取后，正常情况下都会被封装为Message对象，然后由Application工作引擎调用对用的Form.WndProc传入该Messsage，由于Form子类重写了该方法，所以如果希望底层能处理相关的消息，需要通过base.WndProc传递到父类继续调用。下面就是一个代码示例来展示控制如果当前的消息是鼠标左键点击，则弹出MessageBox展示“WndProc MouseClick”：</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">WndProc</span>(<span class="params"><span class="keyword">ref</span> Message m</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> WM_LBUTTONDOWN = <span class="number">0x0201</span>;<span class="comment">// 鼠标左键点击</span></span><br><span class="line">    <span class="keyword">if</span> (m.Msg == WM_LBUTTONDOWN)</span><br><span class="line">    &#123;</span><br><span class="line">        MessageBox.Show(<span class="string">&quot;WndProc MouseClick&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">base</span>.WndProc(<span class="keyword">ref</span> m);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="IMessageFilter"><a href="#IMessageFilter" class="headerlink" title="IMessageFilter"></a>IMessageFilter</h3><p>除了上述的WndProc之外，其实更加便于处理应该的实现IMessageFilter接口，然后让Application将实现该接口的消息过滤器添加到Application中：</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">MyMessageFilter</span> : <span class="title">IMessageFilter</span></span><br><span class="line"> &#123;</span><br><span class="line">     <span class="function"><span class="keyword">public</span> <span class="keyword">bool</span> <span class="title">PreFilterMessage</span>(<span class="params"><span class="keyword">ref</span> Message m</span>)</span></span><br><span class="line"><span class="function"></span>     &#123;</span><br><span class="line">         <span class="comment">//返回值为true， 表示消息已被处理，不要再往后传递，因此消息被截获</span></span><br><span class="line">         <span class="comment">//返回值为false，表示消息未被处理，需要再往后传递，因此消息未被截获</span></span><br><span class="line">         <span class="keyword">const</span> <span class="keyword">int</span> WM_LBUTTONDOWN = <span class="number">0x0201</span>;<span class="comment">// 鼠标左键点击</span></span><br><span class="line">         <span class="keyword">if</span> (m.Msg == WM_LBUTTONDOWN)</span><br><span class="line">         &#123;</span><br><span class="line">             MessageBox.Show(<span class="string">&quot;MyMessageFilter MouseClick&quot;</span>);</span><br><span class="line">             <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">         &#125;</span><br><span class="line">         <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p>编写完成后，在应用程序初始化的过程中，添加该过滤器：</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Application.AddMessageFilter(<span class="keyword">new</span> MyMessageFilter());</span><br></pre></td></tr></table></figure>
<p>同样的，我们启动应用程序并点击实验，可以看到正常的MessageBox输出。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://compilemind.com/2020/02/04/2020-02-04-%E5%9F%BA%E4%BA%8ETesseract%E7%BB%84%E4%BB%B6%E7%9A%84OCR%E8%AF%86%E5%88%AB%E5%AD%A6%E4%B9%A0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="w4ngzhen">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CompileMind">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/02/04/2020-02-04-%E5%9F%BA%E4%BA%8ETesseract%E7%BB%84%E4%BB%B6%E7%9A%84OCR%E8%AF%86%E5%88%AB%E5%AD%A6%E4%B9%A0/" class="post-title-link" itemprop="url">基于Tesseract组件的OCR识别</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-02-04 00:00:00" itemprop="dateCreated datePublished" datetime="2020-02-04T00:00:00+08:00">2020-02-04</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-10-13 15:20:30" itemprop="dateModified" datetime="2020-10-13T15:20:30+08:00">2020-10-13</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="背景以及介绍"><a href="#背景以及介绍" class="headerlink" title="背景以及介绍"></a>背景以及介绍</h2><p>欲研究C#端如何进行图像的基本OCR识别，找到一款开源的OCR识别组件。该组件当前已经已经升级到了4.0版本。和传统的版本（3.x）比，4.0时代最突出的变化就是基于LSTM神经网络。Tesseract本身是由C++进行编写，但为了同时适配不同的语言进行调用，开放调用API并产生了诸如Java、C#、Python等主流语言在内的封装版本。本次主要研究C#封装版。</p>
<h2 id="项目结构"><a href="#项目结构" class="headerlink" title="项目结构"></a>项目结构</h2><p>Tesseract本身由C++编写并开源在<a target="_blank" rel="noopener" href="https://github.com/tesseract-ocr/tesseract">Github</a>，在3.X版本中，Tesseract的识别模式为字符识别，该种识别方式识别能力较低，所以在后来的4.X版本中，引入了LSTM（Long short-term memory，长短期记忆神经网络），极大的提升了识别率。为了让不同的语言均能够使用Tesseract进行OCR识别，Tesseract也是开放了API并产生了诸如Java、C#、Python等主流语言在内的封装版本。而本次C#端的封装版也开源在了<a target="_blank" rel="noopener" href="https://github.com/charlesw/tesseract">Github</a>，目前已知的C#封装版已发布在nuget上，封装了对应Tesseract的版本为3.05.02。所以目前的项目结构如下：<br><img src="https://cdn.jsdelivr.net/gh/w4ngzhen/CDN/images/post/2020-02-04-tesseract/版本封装.png" alt="版本封装"></p>
<h2 id="Demo实验"><a href="#Demo实验" class="headerlink" title="Demo实验"></a>Demo实验</h2><h3 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h3><h4 id="文本识别数据包准备"><a href="#文本识别数据包准备" class="headerlink" title="文本识别数据包准备"></a>文本识别数据包准备</h4><p>因为图像识别本身需要文本识别数据进行匹配，所以我们需要下载对应Tesseract官方的文本数据包：<br><a target="_blank" rel="noopener" href="https://tesseract-ocr.github.io/tessdoc/Data-Files">https://tesseract-ocr.github.io/tessdoc/Data-Files</a><br>注意，针对不同版本的Tesseract-OCR（3.X和4.X底层的实现方式不同，所以文本识别数据包是不同的），我们需要找到对应的不同的文本训练数据包，官网为了更好的兼容性，4.X版本的文本数据包是兼容了3.X版本的。</p>
<p>&gt;<br>the third set in tessdata is the only one that supports the legacy recognizer. The 4.00 files from November 2016 have both legacy and older LSTM models. The current set of files in tessdata have the legacy models and newer LSTM models (integer versions of 4.00.00 alpha models in tessdata_best).<br>&gt;</p>
<p><img src="https://cdn.jsdelivr.net/gh/w4ngzhen/CDN/images/post/2020-02-04-tesseract/数据包下载.png" alt="数据包下载"></p>
<p>为了Demo，我下载了中文简体和英文的数据包作为实验对象</p>
<h4 id="开发环境准备"><a href="#开发环境准备" class="headerlink" title="开发环境准备"></a>开发环境准备</h4><p>为了实验并对比上面两个封装版本的识别效果，这里在同一解决方案中创建了两个项目：<br><img src="https://cdn.jsdelivr.net/gh/w4ngzhen/CDN/images/post/2020-02-04-tesseract/项目创建.png" alt="项目创建"></p>
<p>BaseNewBeta使用的是封装了4.1版本Tesseract的C#封装版Tesseract.4.1.0-beta1，因为该版本还还没有上传只Nuget，所以只能从github上下载，放到本地，然后把对应的C++的底层库（leptonica-1.78.0.dll，tesseract41.dll）放置到了x86和x64文件夹下面且需要输出。</p>
<p>BaseNuget是已经上传至Nuget的封装了底层库3.05.20版本的C#封装版3.3.0.0，因为使用nuget进行组件安装，所以x64和x86的Tesseract组件会在编译输出时候自动输出到对应的生成目录。</p>
<h4 id="核心代码"><a href="#核心代码" class="headerlink" title="核心代码"></a>核心代码</h4><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (openFileDialog1.ShowDialog() == DialogResult.OK)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//PictureBox控件显示图片</span></span><br><span class="line">    pictureBox1.Load(openFileDialog1.FileName);</span><br><span class="line">    <span class="comment">//获取用户选择文件的后缀名 </span></span><br><span class="line">    <span class="keyword">string</span> extension = Path.GetExtension(openFileDialog1.FileName);</span><br><span class="line">    <span class="comment">//声明允许的后缀名 </span></span><br><span class="line">    <span class="keyword">string</span>[] str = <span class="keyword">new</span> <span class="keyword">string</span>[] &#123; <span class="string">&quot;.jpg&quot;</span>, <span class="string">&quot;.png&quot;</span> &#125;;</span><br><span class="line">    <span class="keyword">if</span> (!str.Contains(extension))</span><br><span class="line">    &#123;</span><br><span class="line">        MessageBox.Show(<span class="string">&quot;仅能上传jpg,png格式的图片！&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//识别图片文字</span></span><br><span class="line">        Bitmap img = <span class="keyword">new</span> Bitmap(openFileDialog1.FileName);</span><br><span class="line">        <span class="comment">// 构建识别引擎</span></span><br><span class="line">        TesseractEngine orcEngine = <span class="keyword">new</span> TesseractEngine(<span class="string">&quot;./tessdata&quot;</span>, <span class="string">&quot;eng&quot;</span>);</span><br><span class="line">        <span class="comment">// 识别并获取文本数据</span></span><br><span class="line">        Page page = orcEngine.Process(img);</span><br><span class="line">        richTextBox1.Text = page.GetText();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="最终效果"><a href="#最终效果" class="headerlink" title="最终效果"></a>最终效果</h4><h5 id="英文识别效果"><a href="#英文识别效果" class="headerlink" title="英文识别效果"></a>英文识别效果</h5><p>先是3.X版本识别：<br><img src="https://cdn.jsdelivr.net/gh/w4ngzhen/CDN/images/post/2020-02-04-tesseract/EnNuget.png" alt="EnNuget"><br>可以看到文本中还有很多识别的错误的，特别是把英文字符C识别为了括号（。<br>而封装了新版本的识别结果比起之前更好：<br><img src="https://cdn.jsdelivr.net/gh/w4ngzhen/CDN/images/post/2020-02-04-tesseract/EnNewBeta.png" alt="EnNewBeta"></p>
<h5 id="中文识别效果"><a href="#中文识别效果" class="headerlink" title="中文识别效果"></a>中文识别效果</h5><p>先是3.X版本识别：<br><img src="https://cdn.jsdelivr.net/gh/w4ngzhen/CDN/images/post/2020-02-04-tesseract/CNNuget.png" alt="CNNuget"><br>然后是封装的版本：<br><img src="https://cdn.jsdelivr.net/gh/w4ngzhen/CDN/images/post/2020-02-04-tesseract/CNNewBeta.png" alt="CNNewBeta"><br>看的出来，官方的数据包对于中文的识别还是有很大问题的，不过庆幸的是，4.X版本的后的Tesseract支持我们使用的自己的数据进行识别训练。这样一来，虽然该组件还比不上市面上大多数的商业OCR识别，但是我们可以使用训练数据，来训练适用于我们特定业务的文字识别（比如XX码的提取之类）</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://compilemind.com/2019/02/25/2019-02-25-%E9%82%A3%E4%BA%9B%E6%88%91%E7%94%A8Windows%E6%97%B6%E5%BF%85%E5%A4%87%E7%9A%84%E8%BD%AF%E4%BB%B6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="w4ngzhen">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CompileMind">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/02/25/2019-02-25-%E9%82%A3%E4%BA%9B%E6%88%91%E7%94%A8Windows%E6%97%B6%E5%BF%85%E5%A4%87%E7%9A%84%E8%BD%AF%E4%BB%B6/" class="post-title-link" itemprop="url">那些我用Windows时必备的软件</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-02-25 00:00:00" itemprop="dateCreated datePublished" datetime="2019-02-25T00:00:00+08:00">2019-02-25</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-10-13 15:20:30" itemprop="dateModified" datetime="2020-10-13T15:20:30+08:00">2020-10-13</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="坚果云"><a href="#坚果云" class="headerlink" title="坚果云"></a><a target="_blank" rel="noopener" href="https://www.jianguoyun.com/s/downloads">坚果云</a></h1><h1 id="Microsoft-YaHei-Mono-字体-（提取码：epsq）"><a href="#Microsoft-YaHei-Mono-字体-（提取码：epsq）" class="headerlink" title="Microsoft YaHei Mono 字体 （提取码：epsq）"></a><a target="_blank" rel="noopener" href="https://pan.baidu.com/s/1WuCJ5VW7nypzp4dgCTcMtQ">Microsoft YaHei Mono 字体</a> （提取码：epsq）</h1><h1 id="7-Zip"><a href="#7-Zip" class="headerlink" title="7-Zip"></a><a target="_blank" rel="noopener" href="https://www.7-zip.org/">7-Zip</a></h1><h1 id="AIDA64Extreme"><a href="#AIDA64Extreme" class="headerlink" title="AIDA64Extreme"></a><a target="_blank" rel="noopener" href="https://www.aida64.com/downloads">AIDA64Extreme</a></h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">key：FARRD-CU2D6-J9D59-LD2Q4-3AJG7</span><br></pre></td></tr></table></figure>
<h1 id="apache-maven"><a href="#apache-maven" class="headerlink" title="apache-maven"></a><a target="_blank" rel="noopener" href="http://maven.apache.org/download.cgi">apache-maven</a></h1><ol>
<li>环境变量设置</li>
<li>阿里镜像配置<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">// bin目录conf中复制一份settings.xml到用户目录/.m2/下（没有就手动创建）</span><br><span class="line">// 在settings.xml的mirrors节点下面添加如下子节点</span><br><span class="line"><span class="tag">&lt;<span class="name">mirror</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">id</span>&gt;</span>nexus-aliyun<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">mirrorOf</span>&gt;</span>central<span class="tag">&lt;/<span class="name">mirrorOf</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">name</span>&gt;</span>Nexus aliyun<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">url</span>&gt;</span>http://maven.aliyun.com/nexus/content/groups/public<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mirror</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>命令行进行初始化<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn help:system</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h1 id="BaiduNetdisk"><a href="#BaiduNetdisk" class="headerlink" title="BaiduNetdisk"></a><a target="_blank" rel="noopener" href="https://pan.baidu.com/download">BaiduNetdisk</a></h1><h1 id="VLC-media-player"><a href="#VLC-media-player" class="headerlink" title="VLC media player"></a><a target="_blank" rel="noopener" href="https://www.videolan.org/">VLC media player</a></h1><h1 id="滴答清单"><a href="#滴答清单" class="headerlink" title="滴答清单"></a><a target="_blank" rel="noopener" href="https://www.dida365.com/about/download">滴答清单</a></h1><h1 id="eudic"><a href="#eudic" class="headerlink" title="eudic"></a><a target="_blank" rel="noopener" href="https://www.eudic.net/v4/en/app/eudic">eudic</a></h1><h1 id="Everything"><a href="#Everything" class="headerlink" title="Everything"></a><a target="_blank" rel="noopener" href="https://www.voidtools.com/zh-cn/">Everything</a></h1><h1 id="FSCapture"><a href="#FSCapture" class="headerlink" title="FSCapture"></a><a target="_blank" rel="noopener" href="https://faststone.org/FSCaptureDownload.htm">FSCapture</a></h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">name：bluman</span><br><span class="line">key：VPISCJULXUFGDDXYAUYF</span><br></pre></td></tr></table></figure>
<h1 id="Git"><a href="#Git" class="headerlink" title="Git"></a><a target="_blank" rel="noopener" href="https://git-scm.com/downloads">Git</a></h1><h1 id="grepWin"><a href="#grepWin" class="headerlink" title="grepWin"></a><a target="_blank" rel="noopener" href="https://github.com/stefankueng/grepWin/releases">grepWin</a></h1><h1 id="ILSpy"><a href="#ILSpy" class="headerlink" title="ILSpy"></a><a target="_blank" rel="noopener" href="https://github.com/icsharpcode/ILSpy/releases">ILSpy</a></h1><h1 id="jdk8（AdoptOpenJDK）"><a href="#jdk8（AdoptOpenJDK）" class="headerlink" title="jdk8（AdoptOpenJDK）"></a><a target="_blank" rel="noopener" href="https://adoptopenjdk.net/releases.html?variant=openjdk8&amp;jvmVariant=hotspot">jdk8（AdoptOpenJDK）</a></h1><ol>
<li>环境变量设置</li>
</ol>
<h1 id="JetBrains-IntelliJ-IDEA"><a href="#JetBrains-IntelliJ-IDEA" class="headerlink" title="JetBrains IntelliJ IDEA"></a><a target="_blank" rel="noopener" href="https://www.jetbrains.com/idea/download/">JetBrains IntelliJ IDEA</a></h1><h1 id="Microsoft-Visual-Studio"><a href="#Microsoft-Visual-Studio" class="headerlink" title="Microsoft Visual Studio"></a><a target="_blank" rel="noopener" href="https://visualstudio.microsoft.com/zh-hans/vs/">Microsoft Visual Studio</a></h1><h1 id="nodejs"><a href="#nodejs" class="headerlink" title="nodejs"></a><a target="_blank" rel="noopener" href="https://nodejs.org/en/">nodejs</a></h1><h1 id="vim"><a href="#vim" class="headerlink" title="vim"></a><a target="_blank" rel="noopener" href="https://www.vim.org/">vim</a></h1><h1 id="PicGo"><a href="#PicGo" class="headerlink" title="PicGo"></a><a target="_blank" rel="noopener" href="https://github.com/Molunerfinn/PicGo/releases">PicGo</a></h1><h1 id="R"><a href="#R" class="headerlink" title="$$R"></a><a target="_blank" rel="noopener" href="https://github.com/shadowsocks/shadowsocks-windows/releases">$$R</a></h1><h1 id="SumatraPDF"><a href="#SumatraPDF" class="headerlink" title="SumatraPDF"></a><a target="_blank" rel="noopener" href="https://github.com/sumatrapdfreader/sumatrapdf/releases">SumatraPDF</a></h1><h1 id="Thunder-Network-提取码：ufce"><a href="#Thunder-Network-提取码：ufce" class="headerlink" title="Thunder Network (提取码：ufce)"></a><a target="_blank" rel="noopener" href="https://pan.baidu.com/s/1b8mJY_wwGO8zt0nCDVW86Q">Thunder Network</a> (提取码：ufce)</h1><h1 id="Typora"><a href="#Typora" class="headerlink" title="Typora"></a><a target="_blank" rel="noopener" href="https://typora.io/">Typora</a></h1><h1 id="uTools"><a href="#uTools" class="headerlink" title="uTools"></a><a target="_blank" rel="noopener" href="https://u.tools/">uTools</a></h1><h1 id="AutoHotKey"><a href="#AutoHotKey" class="headerlink" title="AutoHotKey"></a><a target="_blank" rel="noopener" href="https://www.autohotkey.com/">AutoHotKey</a></h1><h1 id="WinSCP"><a href="#WinSCP" class="headerlink" title="WinSCP"></a><a target="_blank" rel="noopener" href="https://winscp.net/eng/download.php">WinSCP</a></h1>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://compilemind.com/2019/02/16/2019-02-16-%E5%85%B3%E4%BA%8E%E4%BA%BA%E7%9A%84%E6%80%9D%E8%80%83/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="w4ngzhen">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CompileMind">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/02/16/2019-02-16-%E5%85%B3%E4%BA%8E%E4%BA%BA%E7%9A%84%E6%80%9D%E8%80%83/" class="post-title-link" itemprop="url">关于人的思考</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-02-16 23:10:26" itemprop="dateCreated datePublished" datetime="2019-02-16T23:10:26+08:00">2019-02-16</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-10-13 15:20:30" itemprop="dateModified" datetime="2020-10-13T15:20:30+08:00">2020-10-13</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><em>人总是要思考的。人生一世，思考总是每时每刻都伴随我们前行。各种情景中，如：失落、高兴、烦恼等等，我们都要思考。有了思考，我们才能在这个世界立足;有了思考，我们才能与众不同，拥有自己的标志。思考是无形的，但它却在无形中左右着我们的生活，左右着我们的人生之路。“思考”是一件很神奇的东西，因为它，我们才能够解决问题;因为它，我们才能讨论“关于人的思考”。我们的世界正是因为有很多善于思考的人才会如此的进步，也正是因为有那些不善于思考的人才会变的如此复杂。</em></p>
<p>  <strong>关键词：思考;哲学;理解</strong></p>
<h2 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h2><p>古往今来，许许多多的人都在思考“人为什么思考”。人们对于这个话题的讨论的热情从未减少过。的确，这个话题是每个人都想要知道的，因为人的大脑是神秘的，人的思想是神秘的，而人类恰恰有着对神秘事物探索的好奇心。我要研究关于人的思考，也正是基于我对与“思考”的好奇心。现在，我正在用“思考”来思考“关于人的思考”这一个话题，想一想，不免觉得这“人的思考”还真有点趣味。</p>
<h2 id="一、人为什么要思考？"><a href="#一、人为什么要思考？" class="headerlink" title="一、人为什么要思考？"></a>一、人为什么要思考？</h2><p>我们的大脑每一天都没有停歇过，因为它在承担着我们人生之中最重要的一件事，那就是思考。一旦我们忙完一天的事情之后，休息的时候，我们的大脑里的各种想法就会开始浮现出来，各种问题，让我们变得烦恼。偶尔，我们会想为何我们总是毫无成就，偶尔，我们会觉得很郁闷。我们为什么会郁闷的呢？因为我们思考了。<br>人为什么要思考？倘若一个人不思考，可以吗？当然可以，的确，维持生命是每个人或者概括一点的话每个动物的本能，为了让我们能够心中如水般的平静，我们少一点思考也许对我与我们来说反而有好处，毕竟烦恼都是思考出来的，比如很多的人也许曾经或者正在花着大量的时间“思考”一些毫无意义的事情，把这些时间用来睡觉，用来运动，难道不比苦坐着伤害脑细胞好吗？</p>
<p>十七世纪法国的伟大科学家和思想家布雷兹.巴斯卡曾经在他的《思想录》中这样写到：“世界上只有三种人：找到上帝事奉上帝的人；竭诚寻求上帝而没有找到上帝的人；活着不肯寻求也没有发现上帝的人。第一种人既有理性而有幸福；第二种人有理性而不幸；最后一种人既愚蠢而有不幸。”巴斯卡的这段话曾启迪了不少人的心灵。为什么不寻求上帝的人就不幸呢？这是一个非常重大的课题。谁都知道，人是有智慧的高等动物，人和其它动物之间的本质区别，就在于人有智慧，人能够思考，可以通过思考，透过现象，发现本质、认识本质，而其它动物则不能。然而人类却把思考忽略了，世界上就有很多人没有利用人所特有的这一本质特征，没有利用思考，不肯致力思考这一重大的课题。他们对于鸡虫琐事、各位荣辱金钱享受却绞尽脑汁，充满预感；而对于什么是真正的幸福？什么是真正的不幸？对于身何从来，死往而去这样一些重大的课题，去无动于衷，麻木不仁。这样的理性知识问题，难道可以用鸡犬禽兽的感觉或用庸愚之辈、贪生之徒的理解来回答吗？他们既无远见有无畏惧地玩忽这一重大课题，而不知不觉地走向死亡；明知他们所为之奋斗一切，将来随着死亡而失去，对自己永恒的命运，却漠然无动于衷。这是何等的可悲，何等的不幸啊！</p>
<h2 id="二、人该如何思考？"><a href="#二、人该如何思考？" class="headerlink" title="二、人该如何思考？"></a>二、人该如何思考？</h2><p>通常来讲，人一天要遇到很多问题。可是有多少是自己认真的处理分析的呢！ 往往都是问题在自己这匆匆而过，就是抓不住。 要想不让问题跑掉，首先要做到的就是守住问题不放，怎么守的住呢！ 就是要淡定，对待自己遇到的事情要淡定。所以，思考问题的第一步，就是要把问题抓住看明白，怎么抓住，就要怎么守住，就要做到淡定！为什么淡定就能守住呢！  因为淡定可以使得人神气稳定不散，所以能守得住。那么，再让我们回到今天要说明的问题上来，就是 “人该如何思考问题”。</p>
<p>在上面，我们已经把问题抓住了，要做的是要把问题往好的方向去处理，现实的说法就是立场问题。这个立场要符合一个原则就是：积极、发展、上进。 面对问题，唯独积极上进，才可在顺境之中越走越远，在逆境之中越加坚强。在“淡定”的基础之上，再以一种上进的心去思考，我想我们已经获得了一种很好的思考方式了。</p>
<p>那么，在达到上面的条件后，现在我们可以做到不受任何情绪干扰的来处理问题了，做到这一步真的不容易。可 是事情总有难有易的，那遇到真正的难题怎么办呢！ 一方面非得解决，一方面又解决不了。这个时候也要注意方法。就是不要抓住问题不放，为什么这么说呢。当守住一个难题不放松的时候，外面就因为感到无法解决而觉得空虚，心里呢，也会被问题困住不得解脱。这时，我们就要懂得“止”，何谓“止”？就是停一会，总结一下，接下来再做，这么做，不仅不会在思考的时变得压抑，反而会使得底气更充足。思考问题的效果也很好，有句话叫“思之而不通，鬼神将通之。非鬼神之力，精气之极也”。就是讲，这么来思考问题，就象有神仙帮助一样，能很好的解决问题。</p>
<p>样下来，问题分析的有结果了。有结果之后也要注意，不要以为分析完成了就了事了。还有重要的一步要去做，就是分析结果出来后，要回到开始遇到的问题上面想想。是这么个问题发生了这样许多的事情。为什么要做这样一步呢！思考的过程我们可以理解为大脑运转的过程，在我看来是一种轮回。所以想的结果要回到思考的问题上，这样才是一个完整的思考过程。如果不回到思考的问题上，实际上就是轮回没有完全终止，给人一种不连续的感觉。<br>小结</p>
<p>思考，也许对于许多的哲学家来说，是一个永恒的话题。新的问题在思考中诞生，更新的问题又在解决中诞生。我觉得这都是思考在控制着。个人的一生是短暂的，快乐的时间更是短暂的，世界上的人很多，每一个人在社会中都有他的位置，把自己的心思用到自己所能力及的地方，不要花费你宝贵的生命、时间去思考那些属于别人的问题了，重复建设既不利于解决问题又浪费时间和感情。不要花费属于你自己的时间去议论别人的长短了，大家活的都很累，何必烦人又烦己呢？最后，人的思考是不可避免的，但是如何又能避免思考所带来的新的问题呢？我想，人为什么要思考就是这个问题的答案。</p>
<h2 id="文献"><a href="#文献" class="headerlink" title="文献"></a>文献</h2><blockquote>
<p>[1] 胡道位. 帕斯卡尔《思想录》读解[D].扬州大学,2012.<br>[2] 陈宣良. 思考的芦苇——读帕斯卡尔《思想录》[J]. 读书,1986,07:39-44.<br>[3] 海伦·杜卡斯,巴纳希·霍夫曼,李宏昀. 爱因斯坦谈人生[J]. 书城,2014,01:130.<br>[4] 杨叶平,李晗龙. 从哲学的角度思考人生价值[J]. 学理论,2009,27:110-111.</p>
</blockquote>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://compilemind.com/2019/01/15/2019-01-15-%E7%A1%9D%E7%83%9F%E4%B8%AD%E7%9A%84Scrum%E5%92%8CXP/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="w4ngzhen">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CompileMind">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/01/15/2019-01-15-%E7%A1%9D%E7%83%9F%E4%B8%AD%E7%9A%84Scrum%E5%92%8CXP/" class="post-title-link" itemprop="url">硝烟中的Scrum和XP</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-01-15 22:49:37" itemprop="dateCreated datePublished" datetime="2019-01-15T22:49:37+08:00">2019-01-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-10-13 15:20:30" itemprop="dateModified" datetime="2020-10-13T15:20:30+08:00">2020-10-13</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>初次接触Scrum和XP（更加准确的说是“看到”），心里不免有些疑问，软件开发为什么会有如此多的方式，难道软件开发、软件工程不就是写写代码的事儿吗？直到后来，才明白，一个庞大的软件工程，不会只是一个人的事儿，倘若我们现在（学生时代）还是只有着一种写代码是自己的事儿的态度来看待软件工程这样的“工程”，是低端的，是不全面的。</p>
<p>作为一名软件工程的学生，编写代码的能力是一方面，理解计算机对于代码编辑、编译、链接、运行过程是一方面，理解算法、数据结构有事另一方面。这些当然是我们软件工程学生应该有的素质，但同时，我们还应该明白，一个只有几个人能胜任的软件工程的小组毕竟只是少数，少数中的少数，更多的则是庞大的集合体，我们（对于一般的程序员、工程师）只这个庞大的集合体中的一两个小小的元素。所以，我们应当有团队意识。</p>
<p>说了一大堆空白话，让我们回到《硝烟中的Scrum和XP》来。</p>
<p>何为Scrum？这里我不想复制某度百科一堆，我只想说说我的理解（拙见），在我看来，Scrum更加给人一种具有技术的高效开发团队组织的感觉，这个组织拥有对于时间掌控的能力，能够充分利用时间的分割来进行项目的开发、管理，从这一点来看，Scrum更加注重管理，注重一种形式，一种规则。XP则是在另一番景象，XP所做到的是注重了编程的实践，注重强有力的工程实践，是实际的，具有技术的。为什么二者能够和谐的处在一起，因为它们都是在处理软件工程领域不同的部分，而不同的部分，则是软件工程如今所面临的重要之处，同时，它们都强调了个人与组织的关系，强调了个人应当与组织形成一种高效的交流。本书序章中看到了一句话“实际上，Scrum和XP都关注如何把事情做好”。的确如此，所以才造就了如今的敏捷开发与极限编程所拥有的魅力。</p>
<p>Scrum与XP的共同点：实践与交流。正如书中所说“但在纷乱芜杂的信息中，我感到最有价值的就是那些真枪实弹的故事。它们把‘原则与实践’变成了‘如何真正动手去做’”。理论知识就是动动嘴皮子，在此我并非贬低理论的形成过程，是的，理论也是需要动用你的大脑去真正的考虑设置一种想法的“实现”，这种“实现”并不是简单想想就能搞定的。但是，现实是残酷的，时间是不等人的，在如今的软将工程这个领域里，你永远不知道“下一个巧克力是什么味道的”。甜的，恭喜你“侥幸”度过了软件工程实践里的难处；哭的，很遗憾，你的项目，你的工程将很有可能面临淘汰。（胡乱扯了一通，拙见）</p>
<p>在书中我还看到了一个很有意思或者说确实也出现在我身上的事例。就是在backlog这一部分，书中所讲的就是“需求，或故事，或特性等组成的列表”，理解一下就是贴了一些便条的梗概，这些都是业务层次上的（产品负责人来负责），不需要你添加一些技术性的问题在其中（技术人员的事儿）。然而（比如我）在写这个backlog的时候，常常就会添加一些技术性的比如这里用某某算法、这里用某某结构体等来描述，这实际上已经突破了业务的层次，这在实际过程中应当避免。</p>
<p>本书中还提到了Scrum Master：负责监督整个Scrum进程。是的，Scrum确实需要这样的Master存在，Scrum Master并非团队的领导，而是一个负责屏蔽外界对开发团队干扰的角色。Scrum Master是规则的执行者，他是Scrum团队中的服务型领导。不难看出，SM的需要非常熟悉敏捷开发模式，同时还需要很强的能力。</p>
<p>我在看这本书的时候，其实并没有太关注Scrum与XP的过程，而是在思考Scrum与XP的思想，这样的思想是如何体现的。其实作为一名程序员，我们不能仅仅关注于技术，而是应当在做技术的同时，思考一些理念，一些想法，一些蕴藏在软件开发之中的文化（当然实在已经有较好的技术的前提下，否则就是理想主义者了）。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://compilemind.com/2019/01/01/2019-01-01-%E4%BA%BA%E6%9C%88%E7%A5%9E%E8%AF%9D/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="w4ngzhen">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CompileMind">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/01/01/2019-01-01-%E4%BA%BA%E6%9C%88%E7%A5%9E%E8%AF%9D/" class="post-title-link" itemprop="url">人月神话</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-01-01 22:47:40" itemprop="dateCreated datePublished" datetime="2019-01-01T22:47:40+08:00">2019-01-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-10-13 15:20:30" itemprop="dateModified" datetime="2020-10-13T15:20:30+08:00">2020-10-13</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>先来讲一讲“睡前”想法，也许会有所偏离主题，请见谅。初次面对“人月神话”这个标题的时候，就不禁从中感受到了一种差距，一种关于国内与国外（西方）计算机软件相关的文化差距。就最近所接触到的计算机相关知识来看，我觉文艺复兴的意义是非同凡响的，是深远的，最近接触到的许多关于计算机、软件程序相关的书籍，尽管还未曾读过，但名字已经给我留下了深刻的印象。例如，《人件》、《大教堂与集市》、《黑客与画家》、《人月神话》等等。也许我监视太过于片面，但我还是想说尽管国内程序开发人员、管理人员在技术层面上与国外同行差距并不是很大，甚至在某些方面更加优秀，然而，文化层面却是差了一大截，缺少了灵性，缺少了思维的敢于跳跃。追根溯源，我认为是西方的历史、文艺复兴、文化、哲学给西方的计算机领域注入了太多有意味的，有营养的东西。正如翻开《软件工程》这本厚重的书的第一页，看到序章的第一句话“文艺复兴以降”。</p>
<p>回顾正题，《人月神话》究竟是怎样的一本书呢。你可以把它当作你以后作为一名程序开发者、产品经理或者是任何与计算机相关开发有关的职位的职业手册，因为你可以从中了解到作为一名开发人员，你讲面临怎样的上司，面临怎样的工作境遇，并且你可以从中懂得作为一名开发人员的自律与抗争（抗争所面临的难题、危机）；同时你也可以从中了解到作为一名产品经理你将如何面对团队、面对堆积如山的难题，以及你那“不听话”的手下。</p>
<p>然而，你又可以把它看作一本关于哲学的书籍，一本仅仅是用了大量计算机职场语言、管理语言描述的探讨哲学难题的书籍。在书中，无时无刻不充满着具有哲学意味的探讨，简明却引人入胜。对于我说，这本书就是后者。正如上面所讲的“睡前”想法一样，在软件工程这门课程中，说到了这本书《人月神话》，再看看每章的标题：焦油坑、人月神话、贵族专制、民主政治和系统设计…没有银弹…注定，这本书将不是一本因为计算机软件开发需求的快餐阅读产物，而是一本融合了思想的，从真正具有开发管理意义的书籍。看过之后，的确如此，它除去了大量晦涩难懂的，亦或是平淡无味的专业词汇，更像是一本用简明语言阐述在计算机软件开发过程中的文学、哲学问题。对于每章的开头，作者总是以某件贴近生活或者更贴近现象而非抽象的事例来抓住我的阅读胃口。</p>
<p>讲完了一些玄学的东西以后，让我们再来看看一些更加实质性的东西。《人月神话》所站立的角度，很显然是产品经理的方面，或者笼统的说应该是只要是相关软件开发管理的。但是针对程序开发者同样是有作用的，作为程序开发者你懂得如何规范自身开发行为，因为你已经站立在项目经理的角度思考过了，就如同中学老师所讲的“站在出题人的角度，解题才会得心应手”。以上就是我从外在角度来看待这本书的。</p>
<p>在从内容上来看，“焦油坑”预示着从大项目、编程系统产品开发是有多么棘手，它远远超过了所谓的针对一个项目的简简单单的规划。“他们相互纠缠在一起的时候，团队的行动就会变得越来越慢”以及，最重要的一点是，编程系统产品开发是独立小程序的九倍，从这点完全可以印证我上面所说的超过了一个简单的规划，因为很多东西在不经意间，就在就在纠缠这你的团队，你的进度。</p>
<p>而在“人月神话”又向我们表明，“人月”这一估算暗示了工作量与工作进度是可以互换的，然而这种互换有时却又是致命的，显然，15人月的项目，1人15月与5人3月是完完全全不可对等的。再来说一说“没有银弹”，这一章是我最喜欢的章节。作者把一种能将开发效率提高的方法与软件开发分别比作银弹和人狼，又让我心中想起了在前文所说的，一种与西方艺术、西方文化结合的描述。（请原谅我用大把的修辞，譬如“西方艺术”、“西方文化”来结合程序开发管理，因为在我看来这其中定然有着意料之外又在情理之中的联系）回归“没有银弹”，作者在此章预示了“银弹”在未来一段时间内是不可能出现的，尽管技术在不断的革新，但是管理的革新将会是困难的。看完这章以后，我最大的感受就是人不是机器，尽管科技不断革新，编程技术在不断革新，算法在不断革新，但这些终究只是机器方面。一个大型项目，是人机结合的，针对于计算机的、软件的管理是固定的，是有模式，是能够加以限制的。然而对于人来说，却是个“纠缠”的，“不可控”的。</p>
<p>焦油坑依旧存在。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://compilemind.com/2018/12/31/2018-12-31-%E5%86%8D%E8%A7%81%EF%BC%8C%E8%B4%B0%E9%9B%B6%E5%A3%B9%E6%8D%8C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="w4ngzhen">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CompileMind">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/12/31/2018-12-31-%E5%86%8D%E8%A7%81%EF%BC%8C%E8%B4%B0%E9%9B%B6%E5%A3%B9%E6%8D%8C/" class="post-title-link" itemprop="url">再见，贰零壹捌</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-12-31 00:00:00" itemprop="dateCreated datePublished" datetime="2018-12-31T00:00:00+08:00">2018-12-31</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-10-13 15:20:30" itemprop="dateModified" datetime="2020-10-13T15:20:30+08:00">2020-10-13</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h4 id="再见，2018"><a href="#再见，2018" class="headerlink" title="再见，2018"></a>再见，2018</h4><p>这一年我毕业在6月，离别在7月。似乎每个人都要等到怀念的时候，才会觉得当初的好，就像在毕业之后，我时常怀念起大学的美好时光。要说每一幕都难以忘记似乎太假惺惺，但却依然难以忘记大家的第一次的见面，第一次的聚会，第一次的活动，以及第一次也是最后一次的离别。</p>
<p>今年冬天似乎特别的冷，一开始我也很疑惑，但后来明白了，有时候，孤单会让一个人的感官敏感起来，让人失去热情。多少次我想要离别，多少次我却又害怕离别。与我相别的不仅是我的大学生涯，还有那群伴我成长的朋友，以及，我“终将逝去的青春”。我的青春始于2011年的夏天，那一件淋湿的衬衣，我的青春止于2018年夏天，那几本墨绿色的证书。</p>
<p>时间就这样过去了。我常常在想，究竟怎样才算长大。究竟要明白多少的道理才算是长大，为什么父母、长辈就是一种成熟的象征？为什么我们就是和他们有所区别，以至于他们常常会说，“等你长大了就明白了”。后来发觉，我们不过是在模仿长辈，模仿他们的行为，模仿他们的口吻，然后在一个合适的时机，对着我们的晚辈说：“等你长大了就明白了”。渐渐的，我们在模仿中“成长”。但这“成长”终究是假象，当我们模仿的对象，比如父母，出现的时候，我们就好像被打回原形一般，乖乖听着他们的教导。然后，爷爷奶奶一旦出现，父母也立刻“显出原形”，我们之于父母，如同父母之于爷爷奶奶辈一样，终究是孩子。</p>
<p>其实我常常有很多的想法，想要在博客上去诉说，但是正如大多数的常人一样，感觉有千万语言在脑海中涌现，而等到真正下笔的时候，反而一个字写不出来了。这时候我其实总是有点沮丧，沮丧我的“不争气”，“沮丧”我的懒惰。写到此，突然觉得，是该给自己定一些目标来实现了，毕竟如上所说的一样，我们终究是要成长的，定下一些目标，然后一步一步去做些许会让我安心一点。</p>
<h5 id="2018即将过去，定几个重要目标：）"><a href="#2018即将过去，定几个重要目标：）" class="headerlink" title="2018即将过去，定几个重要目标：）"></a>2018即将过去，定几个重要目标：）</h5><p>其实我很少像这样为自己制定目标，因为我老是这样有点故意作秀之嫌，后来发觉，如果定目标定的太多可能真的会这样，所有我就定两三个小目标以鞭策自己。</p>
<h6 id="每个月至少产出3篇有价值的文章，或生活或学习或工作。"><a href="#每个月至少产出3篇有价值的文章，或生活或学习或工作。" class="headerlink" title="每个月至少产出3篇有价值的文章，或生活或学习或工作。"></a>每个月至少产出3篇有价值的文章，或生活或学习或工作。</h6><p>以往我都是学些某些东西的时候，有了心得才写上那么一两篇，我渐渐地发现不再那么“勤劳”了。仔细一想还是定一个目标好一些，一来保持写作习惯（虽然我的写作功力真的很差）；二来保持技能的熟悉程度，把心得记录下来也是不错的。</p>
<h6 id="开始坚持每天跳绳锻炼（依据阶段1-3-5-10-min进行）。"><a href="#开始坚持每天跳绳锻炼（依据阶段1-3-5-10-min进行）。" class="headerlink" title="开始坚持每天跳绳锻炼（依据阶段1 - 3 - 5 - 10 min进行）。"></a>开始坚持每天跳绳锻炼（依据阶段1 - 3 - 5 - 10 min进行）。</h6><p>为什么是跳绳？为什么不是健身、跑步呢？出于场地、时间等考虑（主要是场地），我没有选择进行所谓的“锻炼宏图”，免得弄的过于“专业”，结果适得其反，从一些简单的小锻炼（跳绳）入手，每天晚上回到家，在小区里跳绳，不需要什么专业的场地，我觉得更能长期坚持。而且据我查到的相关知识，让我对跳绳更加有了信心：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1、可以减肥，能使全身的肉变得结实有弹性，减少大腿及臀部的脂肪，健美塑性，使得身体动作敏捷。</span><br><span class="line">2、可以长个子。跳绳可以促进骨骼的生长，从而达到长个子的效果。</span><br><span class="line">3、能锻炼耐力。经常跳绳的人，能很好的锻炼耐力。</span><br><span class="line">4、能帮助我们很好的放松情绪。</span><br><span class="line">5、能缓解腰酸背痛。经常做办公室的上班者，可采用跳绳的方法，缓解身体的酸痛。</span><br><span class="line">...balabala</span><br></pre></td></tr></table></figure></p>
<h6 id="找到女朋友"><a href="#找到女朋友" class="headerlink" title="找到女朋友"></a>找到女朋友</h6><p>这条可以不实现。：）</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://compilemind.com/2018/11/11/2018-11-11-%E6%BC%94%E5%91%98%20Or%20%E5%BC%80%E5%8F%91%E8%80%85%E7%9A%84%E8%87%AA%E6%88%91%E4%BF%AE%E5%85%BB/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="w4ngzhen">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CompileMind">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/11/11/2018-11-11-%E6%BC%94%E5%91%98%20Or%20%E5%BC%80%E5%8F%91%E8%80%85%E7%9A%84%E8%87%AA%E6%88%91%E4%BF%AE%E5%85%BB/" class="post-title-link" itemprop="url">演员 Or 开发者的自我修养</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-11-11 00:00:00" itemprop="dateCreated datePublished" datetime="2018-11-11T00:00:00+08:00">2018-11-11</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-10-13 15:20:30" itemprop="dateModified" datetime="2020-10-13T15:20:30+08:00">2020-10-13</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>时至今日，我都还是很怀念小时候与一群玩伴编写剧本、拍摄，那时候的我还有一个远大的“白日梦”——成为一名导演。很可惜，终究是“白日梦”。在完成了一系列的“艰苦”拍摄以后，一个半成品的微电影就出世了：没有字幕，没有主题，昏暗的镜头，富有浓郁特色的四川方言。随后发布到网上，差评如潮：）。</p>
<p>如今的我，已投奔IT，愈来愈热爱这个职业。成为一名合格的软件开发者，已经成为了我现在的理想，而非“白日梦”。为什么我会去读《演员的自我修养》？大概是在一代喜剧之王周星驰的影响之下，想要看看这本书真正的魅力。尽管是一本完全讲述表演艺术的书籍，不过在阅读的过程中，我却能够联想到很多对于IT，对于软件工程的东西，大概是我的脑洞太大吧。</p>
<p>《演员的自我修养》第一部分以日记的形式，记叙了一个名叫Kostya的戏剧系大学一年级学生以及他的同班同学们在斯坦尼斯拉夫斯基式的表演教学方法下度过的一年时光。这样一群学生，没有或者极少有表演的经验，在他们的导师也是他们的戏剧排演的导演的协同之下，进行舞台表演。对于这期间的描述，斯坦尼斯拉夫斯基表达出了对于舞台戏剧的各种理论原理的态度，以及指出了在实践中各种各种各样的不良现象。仔细想一想，这一部分和我们软件工程的似乎是很相像的。初出茅庐的一群软件开发者，没有或者极少有实践的经验（毫无疑问，没有或者极少有实践经验在当前的IT领域是常见的），在主管或者部门老大的带领之下一同协作进行软件开发。于是乎，各种各样的弊端出现，没有精确版本控制，没有标准化的代码规范，没有一个明确的项目目标，业务开发ACID日复一日。其实，对于一个软件项目，和一个舞台是很像的。每一位开发者都是上面的表演者，他们各自运用其学到的理论知识，为舞台剧贡献自己的一份力量。但是，若没有真正的体会，没有真正的热爱这项事业，只是抱着假大空的理论，棒读台词（一味地照着别人的代码），这样的舞台剧会有人为其买单吗？结果可想而知。</p>
<p>斯坦尼斯拉夫斯基在第二部分阐述了一种体验艺术的思想。何谓体验艺术？即不仅仅是在表演的过程中才全身心的投入，而是每时每刻都要有这样一种意识，他认为：“……只有这种充满了人——演员的活生生的、有机的体验的舞台艺术，才能够把角色内心生活的一切不可捉摸的细微变化和全部深度，艺术地表达出来。”在联想一下，对比着我们日常的开发，开发者写下的每一行代码都在不断的塑造整个“舞台”中的内容，每一位开发者都是“演员”，若没有一种奉献的精神，没有一种每时每刻的都为了追求代码质量的意识，没有以工程、以代码的角度去开发，这样的“舞台剧”势必轻则不被人看好，重则影响后续人员的加入。剧本愈来愈难以看懂，难以维护。</p>
<p>读过《人月神话》的人都知道，软件工程永远充满了焦油坑。我大概没有那么大的神力去挽救如今IT行业充斥的各种各样的“坑”，但是我不会因此而随波逐流，丧失斗志，做一个只在底层打拼的龙套演员。都说，不会写代码的演员不是好的工程师。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://compilemind.com/2018/10/25/2018-10-25-%E4%B9%9D%E9%9B%B6%E5%90%8E/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="w4ngzhen">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CompileMind">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/10/25/2018-10-25-%E4%B9%9D%E9%9B%B6%E5%90%8E/" class="post-title-link" itemprop="url">九零后</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-10-25 00:00:00" itemprop="dateCreated datePublished" datetime="2018-10-25T00:00:00+08:00">2018-10-25</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-10-13 15:20:30" itemprop="dateModified" datetime="2020-10-13T15:20:30+08:00">2020-10-13</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>“70后”是理想，“80后”是仗义，那么“90后”是什么？</p>
<p>2019年，最小的“90后”应该已经步入了大学校园，正找寻着自己的理想；最大的“90后”应该有的已经成家立业，担起了另一种角色。或许他们曾失落过、迷茫过，但他们终将一一突破。</p>
<p>似乎每一代人，都要经历一个先被否定然后再为自己正名的过程。就像是一个孩子的成人礼，当人们意识到他不再柔弱、不再荒唐的时候，他才是真正地长大了。</p>
<p>“垮掉的‘90后’”这个标题像是无情的审判，给予他们沉重的打击。后来大家慢慢发现，似乎每一代都陷入了被上一代人否定的怪象，就好像“你们是我教过的最差的一届”。但为什么偏偏又不是““70后”垮掉”？不是““80后”垮掉”的？在我看来，“90后”所处的时代，也就是当前，它是信息最为开放的时代！“90后”有着不循规蹈矩爱创新的秀自我价值观、既开放又理性的消费观、为爱而爱宁缺毋滥的恋爱观、追求品质提前养身的生活观，但这些与70、80后的观念显得大相径庭，以至于“90后”太容易被贴上“不稳重”、“太不传统”的标签。再加上信息的开放，导致“90后”所做的一切都被放大放大再放大。“90后”只想说：求同存异！Why not?</p>
<p>“我知道我的未来不是梦”，那未来是什么呢？王小波在《黄金时代》曾说：“那一年我二十一岁，我有好多奢望。我想爱，想吃，还想在一瞬间变成天上半明半暗的云。后来我才知道，生活就是个缓慢受锤的过程。”70、80后的生活，已渐渐步入正轨，而90后才开始接受生活的洗礼。他们的双眼前被迷雾遮住，而迷雾来自生活，让他们看不到未来。时代在变化，相比之下“90后”面对的竞争压力更大、诱惑与选择更多、雾霾也更厚。但是，“90后”更愿意在困境中去奋斗，去突破。他们愿意用更加严谨的方式对待工作，用更加幽默的态度面对生活。“90后”身体力行，跟大家论证了“知识就是力量”这一观点，随着高学历青年大批大批的涌入社会，他们默默地担起了这个时代的使命，在迷茫中坚定，在继承中创新。</p>
<p>很多人说“90后”不稳重，是因为他们爱花钱，缺乏存钱意识，但在我看来，“90后”不穷，他们作为互联网的原住民，早已成为了消费的主力军。品质、版权意识、多元、体验、参与感等成为了90后的消费标签。他们爱花钱，但不任性，他们热衷于享受生活，提高品质，他们更愿意为故事和文化买单，对于恋爱也信奉宁缺毋滥。</p>
<p>“90后”提前养身，这已经是近几年的热门话题了，他们的特殊养生，似乎是从某个冬天开始，伴随着保温杯里的大枣枸杞，融到了每个“90后”的身体里。“油腻”、“发际线”以及“秃”，每一个词都好像一颗子弹绽放在“90后”的胸口。于是乎，熬夜玩手机对皮肤不好？敷最贵的面膜，用最贵的眼霜；啤酒加冰？No，加枸杞、人参？Yes；暴饮暴食？我有健胃消食。这些年流行一个词叫“佛性”，“90后”表示，这个“佛”既是“济公活佛”，也是“斗战圣佛”。他们明白，倘若就这样默默的接受无情的审判，垮掉的是他们的内心；倘若不试图去拨开眼前的迷雾，未来永远不会到来。</p>
<p>所以，“90后”是什么？<br>“90后”是不被定义的一代！</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://compilemind.com/2018/09/13/2018-09-13-CSharpEntityFramework%E4%B8%8ECodeFirst%E5%AE%9E%E8%B7%B5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="w4ngzhen">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CompileMind">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/09/13/2018-09-13-CSharpEntityFramework%E4%B8%8ECodeFirst%E5%AE%9E%E8%B7%B5/" class="post-title-link" itemprop="url">CSharpEntityFramework与CodeFirst实践</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-09-13 00:00:00" itemprop="dateCreated datePublished" datetime="2018-09-13T00:00:00+08:00">2018-09-13</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-10-13 15:20:30" itemprop="dateModified" datetime="2020-10-13T15:20:30+08:00">2020-10-13</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>当我们进行开发的时候,常常会用到数据库来对数据进行持久化的操作，有的时候,我们并不想要在进行代码开发的过程中，还去关注数据库的构建,表的构建等等。于是，就有了Code First模式。何为Code First模式呢？它思想就是先定义模型中的类，再通过这些类生成数据库。这种开发模式适合于全新的项目，它使得我们可以以代码为核心进行设计而不是先构造数据库。这样一来，使得我们更加关注代码的开发。在c#中，我们使用EntityFramework来实现Code First场景。</p>
<h3 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h3><p>试想一下，现在有一个图书管理项目，里面会用到Book实体类，Book会唯一编号Id、书名Title、价格Price，在数据库优先的情形下，我们可能会首先创建Book对应的表，里面创建对应于Id、Title和Price的字段，然后回到代码中继续来开发，亦或者先在代码中进行开发，然后在需要DA（数据访问）的时候创建数据库以及表结构。无论怎样，我们作为开发都要与数据库进行打交道，来回切换关注的东西，还要注意数据库的表建立的对不对，数据类型对不对等等。好在c#中有了EF这样的强大的框架以及Code First的思想。带给我们全新的开发体验。</p>
<h3 id="实践"><a href="#实践" class="headerlink" title="实践"></a>实践</h3><h4 id="基础配置"><a href="#基础配置" class="headerlink" title="基础配置"></a>基础配置</h4><p>创建一个项目，并利用Nuget引入EntityFramework6</p>
<p><img src="https://cdn.jsdelivr.net/gh/w4ngzhen/CDN/images/post/2018-09-13-EF/nugetef6.png" alt="nugetef6"></p>
<p>当我们引入EF时，我们发现项目下app.config其中的配置会发生更改，这个配置文件<strong>更改的内容</strong>就是EF为我们创建的，也是我们配置数据库连接的地方。</p>
<p>回到项目中，接下来我们创建Book实体类，为其添加Id、Title以及Price属性，同时使用特性在属性以及类名上标注该实体类在数据库中的体现方式：</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title">CodeFirstDemo</span></span><br><span class="line">&#123;</span><br><span class="line">    [<span class="meta">Table(<span class="meta-string">&quot;Book&quot;</span>)</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Book</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">private</span> Guid id;</span><br><span class="line">        <span class="keyword">public</span> Guid Id</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">get</span></span><br><span class="line">            &#123;</span><br><span class="line">                id = id == <span class="literal">null</span> ? Guid.NewGuid() : id;</span><br><span class="line">                <span class="keyword">return</span> id;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        [<span class="meta">Required</span>]</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">string</span> Title &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">        [<span class="meta">Required</span>]</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">double</span> Price &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用Table特性来表名该实体类Book将对应数据库中的book表（不需要此刻已经有Book表），使用[Required]特性来表明字段是否可为空，此外，由于EF默认将Id属性视为主键，所以无需使用[Key]特性来指明上面的Id为主键。</p>
<p>接下来，我们需要使用继承EF的DbContext来构建数据库上下文类，我们直接使用VS自带生成工具即可生成对应的数据库上下文模型：</p>
<p><img src="https://cdn.jsdelivr.net/gh/w4ngzhen/CDN/images/post/2018-09-13-EF/bookdbdemo.png" alt="bookdbdemo"><br><img src="https://cdn.jsdelivr.net/gh/w4ngzhen/CDN/images/post/2018-09-13-EF/genguide.png" alt="genguide"></p>
<p>点击完成后我们就得到了如下的一个配置类</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">BookDbDemo</span> : <span class="title">DbContext</span></span><br><span class="line">   &#123;</span><br><span class="line">       <span class="comment">//您的上下文已配置为从您的应用程序的配置文件(App.config 或 Web.config)</span></span><br><span class="line">       <span class="comment">//使用“BookDbDemo”连接字符串。默认情况下，此连接字符串针对您的 LocalDb 实例上的</span></span><br><span class="line">       <span class="comment">//“CodeFirstDemo.BookDbDemo”数据库。</span></span><br><span class="line">       <span class="comment">// </span></span><br><span class="line">       <span class="comment">//如果您想要针对其他数据库和/或数据库提供程序，请在应用程序配置文件中修改“BookDbDemo”</span></span><br><span class="line">       <span class="comment">//连接字符串。</span></span><br><span class="line">       <span class="function"><span class="keyword">public</span> <span class="title">BookDbDemo</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">           : <span class="title">base</span>(<span class="params"><span class="string">&quot;name=BookDbDemo&quot;</span></span>)</span></span><br><span class="line"><span class="function"></span>       &#123;</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="comment">//为您要在模型中包含的每种实体类型都添加 DbSet。有关配置和使用 Code First  模型</span></span><br><span class="line">       <span class="comment">//的详细信息，请参阅 http://go.microsoft.com/fwlink/?LinkId=390109。</span></span><br><span class="line"></span><br><span class="line">       <span class="comment">// public virtual DbSet&lt;MyEntity&gt; MyEntities &#123; get; set; &#125;</span></span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//public class MyEntity</span></span><br><span class="line">   <span class="comment">//&#123;</span></span><br><span class="line">   <span class="comment">//    public int Id &#123; get; set; &#125;</span></span><br><span class="line">   <span class="comment">//    public string Name &#123; get; set; &#125;</span></span><br><span class="line">   <span class="comment">//&#125;</span></span><br></pre></td></tr></table></figure>
<p>一个十分简单的数据库上下文类就建立完成。</p>
<p>正如生成的DbContext所说：“为您要在模型中包含的每种实体类型都添加 DbSet。”，我们在该类中添加如下的DbSet属性，并将注释删除，更加直观的看一看当前的结构：</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">BookDbDemo</span> : <span class="title">DbContext</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BookDbDemo</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        : <span class="title">base</span>(<span class="params"><span class="string">&quot;name=BookDbDemo&quot;</span></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">virtual</span> DbSet&lt;Book&gt; Books &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在这个类中，我们声明了一个DbSet属性books，这就对应了数据库中的book表。换句话说，继承了DbContext的类就对应了某一个数据库，其连接属性由配置文件中的连接配置决定，并在DbContext中设置进去（基类构造函数设置），这个DbContext中的所有DbSet就对应到数据库中的表。</p>
<p>注意到，构造函数调用了基类构造函数，传入了”name=BookDbDemo”字符串，这个字符串就是指app.config配置文件中的数据库连接名，然后我们查看App.config文件，发现vs已经为我们生成了一个连接字符串节点：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">connectionStrings</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">add</span> <span class="attr">name</span>=<span class="string">&quot;BookDbDemo&quot;</span> <span class="attr">connectionString</span>=<span class="string">&quot;data source=(LocalDb)\MSSQLLocalDB;initial catalog=CodeFirstDemo.BookDbDemo;integrated security=True;MultipleActiveResultSets=True;App=EntityFramework&quot;</span> <span class="attr">providerName</span>=<span class="string">&quot;System.Data.SqlClient&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">connectionStrings</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>但是这还段配置还是有点问题，首先连接地址数据库用户名等等都不对，更主要的是，我是MySQL数据库，怎么能用SQL呢，所以，我们要解决EF进行MySQL的连接问题。</p>
<h4 id="使用EF进行MySQL数据库连接配置"><a href="#使用EF进行MySQL数据库连接配置" class="headerlink" title="使用EF进行MySQL数据库连接配置"></a>使用EF进行MySQL数据库连接配置</h4><p>如果使用ado.net链接mysql数据库则只需要MySql.Data.dll，即使用Nuget安装Mysql.Data就行了，并不需要安装mysql-connector-net驱动程序；</p>
<p>如果使用EF的话一般来说需要安装mysql-connector-net驱动程序；</p>
<p>其中mysql-connector-net驱动程序安装目录包含了<br>MySql.Data.dll；<br>MySql.Data.Entity.EF5.dll；<br>MySql.Data.Entity.EF6.dll；<br>MySql.Fabric.Plugin.dll；<br>MySql.Web.dll；</p>
<p>注意：就算把mysql-connector-net安装目录下所有的类库都拷到bin目录而不在应用环境上安装mysql-connector-net驱动程序，EF代码还是会报错，因为mysql-connector-net安装不仅装了各种dll类库，还在机器上.net环境的全局machine.config里加过如下配置：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">system.data</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">DbProviderFactories</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">add</span> <span class="attr">name</span>=<span class="string">&quot;MySQL Data Provider&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">invariant</span>=<span class="string">&quot;MySql.Data.MySqlClient&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">description</span>=<span class="string">&quot;.Net Framework Data Provider for MySQL&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">type</span>=<span class="string">&quot;MySql.Data.MySqlClient.MySqlClientFactory, MySql.Data, Version=6.9.6.0, Culture=neutral,        PublicKeyToken=c5687fc88969c44d&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">DbProviderFactories</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">system.data</span>&gt;</span></span><br></pre></td></tr></table></figure><br>所以要使用EF必须在站点服务器安装mysql-connector-net启动程序（数据库所在的服务器不需要安装，只需要c#程序所运行的电脑需要安装）<strong>或者</strong>在应用的配置文件（app.config或web.config）里configuration节点下加上上面的配置。</p>
<p>这里，为了我们机器环境的纯净，我们使用nuget安装对应项目需要的库（MySql.Fabric.Plugin.dll和MySql.Web.dll这两个库如果没有需要不用安装）到项目中：</p>
<p><img src="https://cdn.jsdelivr.net/gh/w4ngzhen/CDN/images/post/2018-09-13-EF/mysqldata.png" alt="mysqldata"><br><img src="https://cdn.jsdelivr.net/gh/w4ngzhen/CDN/images/post/2018-09-13-EF/mysqldataentity.png" alt="mysqldataentity"></p>
<p><strong>务必注意！MySql.Data和MySql.Data.Entity必须要保持相同的版本！否则会出现 “找到的程序集清单定义与程序集引用不匹配。 (异常来自 HRESULT:0x80131040)” 的错误，所以这里的Mysql.Data版本我并没有选择最新的</strong></p>
<p>并且在配置文件中加如上述system.data配置，此时app.config配置主要有如下的变化：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">configSections</span>&gt;</span></span><br><span class="line">	...</span><br><span class="line">  <span class="tag">&lt;/<span class="name">configSections</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">startup</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line">  <span class="tag">&lt;/<span class="name">startup</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">entityFramework</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">defaultConnectionFactory</span> </span></span><br><span class="line"><span class="tag">        <span class="attr">...</span></span></span><br><span class="line">    &lt;/defaultConnectionFactory&gt;</span><br><span class="line">    <span class="tag">&lt;<span class="name">providers</span>&gt;</span></span><br><span class="line">      ...</span><br><span class="line">      <span class="comment">&lt;!-- 新增了 MySql.Data.MySqlClient Provider --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">provider</span> <span class="attr">invariantName</span>=<span class="string">&quot;MySql.Data.MySqlClient&quot;</span> <span class="attr">type</span>=<span class="string">&quot;MySql.Data.MySqlClient.MySqlProviderServices, MySql.Data.Entity.EF6, Version=6.10.8.0, Culture=neutral, PublicKeyToken=c5687fc88969c44d&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">providers</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">entityFramework</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">connectionStrings</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">add</span> <span class="attr">name</span>=<span class="string">&quot;BookDbDemo&quot;</span> <span class="attr">connectionString</span>=<span class="string">&quot;data source=(LocalDb)\MSSQLLocalDB;initial catalog=CodeFirstDemo.BookDbDemo;integrated security=True;MultipleActiveResultSets=True;App=EntityFramework&quot;</span> <span class="attr">providerName</span>=<span class="string">&quot;System.Data.SqlClient&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">connectionStrings</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 引入MySql.Data写入的 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">runtime</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">assemblyBinding</span> <span class="attr">xmlns</span>=<span class="string">&quot;urn:schemas-microsoft-com:asm.v1&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependentAssembly</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">assemblyIdentity</span> <span class="attr">name</span>=<span class="string">&quot;MySql.Data&quot;</span> <span class="attr">publicKeyToken</span>=<span class="string">&quot;c5687fc88969c44d&quot;</span> <span class="attr">culture</span>=<span class="string">&quot;neutral&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">bindingRedirect</span> <span class="attr">oldVersion</span>=<span class="string">&quot;0.0.0.0-6.9.6.0&quot;</span> <span class="attr">newVersion</span>=<span class="string">&quot;6.9.6.0&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependentAssembly</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">assemblyBinding</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">runtime</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 手动新增system.data配置节点 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">system.data</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">DbProviderFactories</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">add</span> <span class="attr">name</span>=<span class="string">&quot;MySQL Data Provider&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">invariant</span>=<span class="string">&quot;MySql.Data.MySqlClient&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">description</span>=<span class="string">&quot;.Net Framework Data Provider for MySQL&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">type</span>=<span class="string">&quot;MySql.Data.MySqlClient.MySqlClientFactory, MySql.Data, Version=6.9.6.0, Culture=neutral, PublicKeyToken=c5687fc88969c44d&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">DbProviderFactories</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">system.data</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><br>PS：实际上本人在实践过程中发现，引入Mysql.Data后写如的节点（见上面xml）作用似乎和手动新增的一样，没有求证差别。</p>
<h4 id="实际数据库配置"><a href="#实际数据库配置" class="headerlink" title="实际数据库配置"></a>实际数据库配置</h4><p>完成EF的Mysql连接环境配置后，最基础的数据库还是需要建立的，所以去数据库创建一个名为bookdbdemo的数据库，按道理来说，我们只需要在这个地方触碰到数据库，况且这还是DBA的事情。创建好的数据库如下：</p>
<p><img src="https://cdn.jsdelivr.net/gh/w4ngzhen/CDN/images/post/2018-09-13-EF/mysqldb.png" alt="mysqldb"></p>
<p>于是，我们将其中的连接字符串connectionString内容修改为我们当前的数据库连接字符串：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">  <span class="tag">&lt;<span class="name">connectionStrings</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">add</span> <span class="attr">name</span>=<span class="string">&quot;BookDbDemo&quot;</span> <span class="attr">connectionString</span>=<span class="string">&quot;Data Source=localhost; Database=bookdbdemo; User ID=root; Password=;&quot;</span> <span class="attr">providerName</span>=<span class="string">&quot;MySql.Data.MySqlClient&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">connectionStrings</span>&gt;</span></span><br><span class="line"></span><br><span class="line">注意：providerName写的是在引入MySql.Data.Entity之后在app.config中出现的</span><br><span class="line"><span class="tag">&lt;<span class="name">provider</span> <span class="attr">invariantName</span>=<span class="string">&quot;MySql.Data.MySqlClient&quot;</span> <span class="attr">type</span>=<span class="string">&quot;MySql.Data.MySqlClient.MySqlProviderServices, MySql.Data.Entity.EF6, Version=6.10.8.0, Culture=neutral, PublicKeyToken=c5687fc88969c44d&quot;</span>&gt;</span>节点</span><br></pre></td></tr></table></figure><br>完成上面的配置之后，我们接下来就要使用EF最强大的Migration数据库迁移功能。</p>
<h4 id="EF-Database-Migration-EF数据库迁移"><a href="#EF-Database-Migration-EF数据库迁移" class="headerlink" title="EF Database Migration EF数据库迁移"></a>EF Database Migration EF数据库迁移</h4><p>首先启用迁移功能。在Nuget命令行中输入：Enable-Migrations（有个s，注意）<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">PM&gt;</span><span class="bash"> <span class="built_in">enable</span>-migrations</span></span><br></pre></td></tr></table></figure><br>注意：如果此处提示：具有固定名称“MySql.Data.MySqlClient”的 ADO.NET 提供程序未在计算机或应用程序配置文件中注册或无法加载。需要在上下文继承类中（此处就是BookDbDemo）上添加特性[DbConfigurationType(typeof(MySql.Data.Entity.MySqlEFConfiguration))]<br><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">[<span class="meta">DbConfigurationType(typeof(MySql.Data.Entity.MySqlEFConfiguration))</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">BookDbDemo</span> : <span class="title">DbContext</span></span><br><span class="line">&#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>启动迁移功能后，Nuget命令行提示：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">PM&gt;</span><span class="bash"> <span class="built_in">enable</span>-migrations</span></span><br><span class="line">正在检查上下文的目标是否为现有数据库...</span><br><span class="line">已为项目 CodeFirstDemo 启用 Code First 迁移。</span><br></pre></td></tr></table></figure></p>
<p>此处提示我们，EF的数据迁移功能已经启用，在项目中我们会发现创建了一个名为Migtaions的文件夹，里面还存在一个Configuration配置类，这个类中，我们需要将AutomaticMigrationsEnabled设置为true，即启用自动迁移功能</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">Configuration</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    AutomaticMigrationsEnabled = <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>此时，我们的数据库还没有创建的任何的表。</p>
<p>接下来，我们使用Add-Migtaion XXX命令来添加一个变更模块。</p>
<h4 id="初始化以及创建表"><a href="#初始化以及创建表" class="headerlink" title="初始化以及创建表"></a>初始化以及创建表</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">PM&gt;</span><span class="bash"> add-migration InitDb</span></span><br><span class="line">正在为迁移“InitDb”搭建基架。</span><br><span class="line">此迁移文件的设计器代码包含当前 Code First 模型的快照。在下一次搭建迁移基架时，将使用此快照计算对模型的更改。如果对要包含在此迁移中的模型进行其他更改，则您可通过再次运行“Add-Migration InitDb”重新搭建基架。</span><br></pre></td></tr></table></figure>
<p>注意后面的命名，InitDb只是我们取的名字，为了区分对数据库进行的变更，这里是我们第一次构建，所以我取名为InitDb，完成该命令后，你会发现Migrations文件夹下出现了一个以你迁移模块创建时刻+下划线+刚刚迁移模块的命名的类文件：</p>
<p><img src="https://cdn.jsdelivr.net/gh/w4ngzhen/CDN/images/post/2018-09-13-EF/InitDb.png" alt="InitDb"></p>
<p>其类文件内容如下：</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">partial</span> <span class="keyword">class</span> <span class="title">InitDb</span> : <span class="title">DbMigration</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Up</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            CreateTable(</span><br><span class="line">                <span class="string">&quot;dbo.Book&quot;</span>,</span><br><span class="line">                c =&gt; <span class="keyword">new</span></span><br><span class="line">                    &#123;</span><br><span class="line">                        Id = c.Guid(nullable: <span class="literal">false</span>),</span><br><span class="line">                        Title = c.String(nullable: <span class="literal">false</span>),</span><br><span class="line">                        Price = c.Double(nullable: <span class="literal">false</span>),</span><br><span class="line">                    &#125;)</span><br><span class="line">                .PrimaryKey(t =&gt; t.Id);</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Down</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            DropTable(<span class="string">&quot;dbo.Book&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>我们可以看到里面重写了DbMigration的Up和Down方法，同时从方法中的代码我们能大致推测，Up方法就是发生的变更，这里会创建表Book（dbo是EF的一些配置语法），设置表字段以及设置主键；而Down方法就是回滚操作，将表Book删除。</p>
<p>但是此时，我们数据库中的表还是没有发生变化，因为我们现在添加了变更模块，只是根据当前的代码来的，要将变更同步到数据库，需要Update-Database命令（添加-Versbose方便我们查看数发生执行的SQL语句）：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">PM&gt;</span><span class="bash"> update-database -verbose</span></span><br><span class="line">Using StartUp project &#x27;CodeFirstDemo&#x27;.</span><br><span class="line">Using NuGet project &#x27;CodeFirstDemo&#x27;.</span><br><span class="line">指定“-Verbose”标志以查看应用于目标数据库的 SQL 语句。</span><br><span class="line">目标数据库为: “bookdbdemo”(DataSource: localhost，提供程序: MySql.Data.MySqlClient，来源: Configuration)。</span><br><span class="line">正在应用显式迁移: [201809131330306_InitDb]。</span><br><span class="line">正在应用显式迁移: 201809131330306_InitDb。</span><br><span class="line">create table `Book` (`Id` CHAR(36) BINARY default &#x27;&#x27;  not null ,`Title` longtext not null ,`Price` double not null ,primary key ( `Id`) ) engine=InnoDb auto_increment=0</span><br><span class="line">create table `__MigrationHistory` (`MigrationId` nvarchar(150)  not null ,`ContextKey` nvarchar(300)  not null ,`Model` longblob not null ,`ProductVersion` nvarchar(32)  not null ,primary key ( `MigrationId`) ) engine=InnoDb auto_increment=0</span><br><span class="line">INSERT INTO `__MigrationHistory`(</span><br><span class="line">`MigrationId`, </span><br><span class="line">`ContextKey`, </span><br><span class="line">`Model`, </span><br><span class="line">`ProductVersion`) VALUES (</span><br><span class="line">&#x27;201809131330306_InitDb&#x27;, </span><br><span class="line">&#x27;CodeFirstDemo.Migrations.Configuration&#x27;, </span><br><span class="line"><span class="meta">#</span><span class="bash">中间有一大段经过摘要的字符串，应该是变更的摘要</span></span><br><span class="line">, </span><br><span class="line">&#x27;6.2.0-61023&#x27;);</span><br><span class="line">正在运行 Seed 方法。</span><br></pre></td></tr></table></figure>
<p>我们可以从输出中很容易的看到执行了创建book数据库的sql语句，以及创建了一个MigrationHistory表，这个表就是记录了数据库迁移的一些摘要，供我们以后来进行回退操作。</p>
<p>完成了迁移之后，查看数据库：</p>
<p><img src="https://cdn.jsdelivr.net/gh/w4ngzhen/CDN/images/post/2018-09-13-EF/initcomplete.png" alt="initcomplete"><br><img src="https://cdn.jsdelivr.net/gh/w4ngzhen/CDN/images/post/2018-09-13-EF/tabledetail.png" alt="tabledetail"></p>
<p>我们可以看到，表及其结构按照我们预期创建成功了。</p>
<h4 id="删除表"><a href="#删除表" class="headerlink" title="删除表"></a>删除表</h4><p>为了证明EF再删除表的时候，并不会影响其他的表，我再次利用创建了一个新的实体类EBook并更新DbContext以及进行EF迁移功能：<br><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title">CodeFirstDemo</span></span><br><span class="line">&#123;</span><br><span class="line">    [<span class="meta">Table(<span class="meta-string">&quot;EBook&quot;</span>)</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">EBook</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">private</span> Guid id;</span><br><span class="line">        <span class="keyword">public</span> Guid Id</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">get</span></span><br><span class="line">            &#123;</span><br><span class="line">                id = id == <span class="literal">null</span> ? Guid.NewGuid() : id;</span><br><span class="line">                <span class="keyword">return</span> id;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">set</span></span><br><span class="line">            &#123;</span><br><span class="line">                id = <span class="keyword">value</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        [<span class="meta">Required</span>]</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">string</span> EBookTitle &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>更新DbContext：</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">DbConfigurationType(typeof(MySql.Data.Entity.MySqlEFConfiguration))</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">BookDbDemo</span> : <span class="title">DbContext</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BookDbDemo</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    : <span class="title">base</span>(<span class="params"><span class="string">&quot;name=BookDbDemo&quot;</span></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">virtual</span> DbSet&lt;Book&gt; Books &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="comment">// 新增的DbSet</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">virtual</span> DbSet&lt;EBook&gt; EBooks &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>进行EF数据库迁移，此时我们不需要再次进行启用迁移功能了，而是使用add-migration检测并增加行的变更模块：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">PM&gt;</span><span class="bash"> add-migration AddEBookEntity</span></span><br><span class="line">正在为迁移“AddEBookEntity”搭建基架。</span><br><span class="line">此迁移文件的设计器代码包含当前 Code First 模型的快照。在下一次搭建迁移基架时，将使用此快照计算对模型的更改。如果对要包含在此迁移中的模型进行其他更改，则您可通过再次运行“Add-Migration AddEBookEntity”重新搭建基架。</span><br></pre></td></tr></table></figure>
<p>此时Migrations文件夹下面又增加了新的类文件：</p>
<p><img src="https://cdn.jsdelivr.net/gh/w4ngzhen/CDN/images/post/2018-09-13-EF/addebookentity.png" alt="addebookentity"></p>
<p>其内容和前面大致，创建表以及回滚，这里不再展示。之后我们再次使用update-database命令将变更更新到数据库中，得到当前的数据库内容：</p>
<p><img src="https://cdn.jsdelivr.net/gh/w4ngzhen/CDN/images/post/2018-09-13-EF/afteraddtable.png" alt="afteraddtable"></p>
<p>此时我们将book表中填充一些数据：</p>
<p><img src="https://cdn.jsdelivr.net/gh/w4ngzhen/CDN/images/post/2018-09-13-EF/booktablecontent.png" alt="booktablecontent"></p>
<p>然后，我们将DbContext中的DbSet<EBook>属性删除，再次进行迁移：</p>
<p><img src="https://cdn.jsdelivr.net/gh/w4ngzhen/CDN/images/post/2018-09-13-EF/delebook.png" alt="delebook"></p>
<p>进行更新以后，我们可以看到Ebook表已经删除了，但是book表内容没有发生任何变化：</p>
<p><img src="https://cdn.jsdelivr.net/gh/w4ngzhen/CDN/images/post/2018-09-13-EF/afterdelebook.png" alt="afterdelebook"></p>
<h4 id="变更属性"><a href="#变更属性" class="headerlink" title="变更属性"></a>变更属性</h4><p>有的时候，我们可能很少会将实体类，更多的是对现有实体类中进行属性的增加、删除以及修改，变相的，对数据库中的表的字段进行增加、删除和修改：</p>
<h5 id="增加属性"><a href="#增加属性" class="headerlink" title="增加属性"></a>增加属性</h5><p>现在，我们想要将Book实体类中增加一个Abstract摘要属性，它会影响我们上面我们已有的数据吗？试一试就知道了。</p>
<p>首先，在Book类中增加这一属性，不设置Required特性：</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">[<span class="meta">Required</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">string</span> Title &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"><span class="comment">// 增加的摘要属性</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">string</span> Abstract &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">[<span class="meta">Required</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">double</span> Price &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>此时我们增加变更模块：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">PM&gt;</span><span class="bash"> add-migration AddNewProp</span></span><br><span class="line">正在为迁移“AddNewProp”搭建基架。</span><br><span class="line">此迁移文件的设计器代码包含当前 Code First 模型的快照。在下一次搭建迁移基架时，将使用此快照计算对模型的更改。如果对要包含在此迁移中的模型进行其他更改，则您可通过再次运行“Add-Migration AddNewProp”重新搭建基架。</span><br></pre></td></tr></table></figure><br>我们可以看到变更模块类：<br><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">partial</span> <span class="keyword">class</span> <span class="title">AddNewProp</span> : <span class="title">DbMigration</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Up</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        AddColumn(<span class="string">&quot;dbo.Book&quot;</span>, <span class="string">&quot;Abstract&quot;</span>, c =&gt; c.String(unicode: <span class="literal">false</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Down</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        DropColumn(<span class="string">&quot;dbo.Book&quot;</span>, <span class="string">&quot;Abstract&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>从这个类的Up方法中，我们看，他调用了AddColumn增加列的方法。而Down回退方法则调用了DropColumn删除列的方法。当我们执行update-database命令有什么效果呢？</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">PM&gt;</span><span class="bash"> update-database -verbose</span></span><br><span class="line">Using StartUp project &#x27;CodeFirstDemo&#x27;.</span><br><span class="line">Using NuGet project &#x27;CodeFirstDemo&#x27;.</span><br><span class="line">指定“-Verbose”标志以查看应用于目标数据库的 SQL 语句。</span><br><span class="line">目标数据库为: “bookdbdemo”(DataSource: localhost，提供程序: MySql.Data.MySqlClient，来源: Configuration)。</span><br><span class="line">正在应用显式迁移: [201809131406177_AddNewProp]。</span><br><span class="line">正在应用显式迁移: 201809131406177_AddNewProp。</span><br><span class="line">alter table `Book` add column `Abstract` longtext </span><br><span class="line">INSERT INTO `__MigrationHistory`(</span><br><span class="line">...</span><br><span class="line">）</span><br></pre></td></tr></table></figure>
<p>重点看到这句SQL：“alter table <code>Book</code> add column <code>Abstract</code> longtext ”，这句SQL就是对我们表添加了一个字段，类型为longtext。我们进入数据库中，看一看变化：</p>
<p><img src="https://cdn.jsdelivr.net/gh/w4ngzhen/CDN/images/post/2018-09-13-EF/afteraddprop.png" alt="afteraddprop"></p>
<p>可以看到数据库中其他字段的值都没有发生变化，仅仅多出了这个字段，同时符合我们设置的可以为空的预期</p>
<p><img src="https://cdn.jsdelivr.net/gh/w4ngzhen/CDN/images/post/2018-09-13-EF/addpropdetail.png" alt="addpropdetail"></p>
<h5 id="删除属性"><a href="#删除属性" class="headerlink" title="删除属性"></a>删除属性</h5><p>删除与增加同理，我们直接将Book实体类的属性删除，然后增加变更，最后同步更新变更到数据库。这里我们将Price和Abstract属性都删除，变更模块如下：<br><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">partial</span> <span class="keyword">class</span> <span class="title">RemoveProp</span> : <span class="title">DbMigration</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Up</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        DropColumn(<span class="string">&quot;dbo.Book&quot;</span>, <span class="string">&quot;Abstract&quot;</span>);</span><br><span class="line">        DropColumn(<span class="string">&quot;dbo.Book&quot;</span>, <span class="string">&quot;Price&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Down</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        AddColumn(<span class="string">&quot;dbo.Book&quot;</span>, <span class="string">&quot;Price&quot;</span>, c =&gt; c.Double(nullable: <span class="literal">false</span>));</span><br><span class="line">        AddColumn(<span class="string">&quot;dbo.Book&quot;</span>, <span class="string">&quot;Abstract&quot;</span>, c =&gt; c.String(unicode: <span class="literal">false</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>得到如下的结果：</p>
<p><img src="https://cdn.jsdelivr.net/gh/w4ngzhen/CDN/images/post/2018-09-13-EF/afterdel2prop.png" alt="afterdel2prop"></p>
<h5 id="重命名属性"><a href="#重命名属性" class="headerlink" title="重命名属性"></a>重命名属性</h5><p>重命名比起前面的增删属性有所不同，就当前情形为例子，当前Book类属性如下：<br><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title">CodeFirstDemo</span></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    [<span class="meta">Table(<span class="meta-string">&quot;Book&quot;</span>)</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Book</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">private</span> Guid id;</span><br><span class="line">        <span class="keyword">public</span> Guid Id</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">get</span></span><br><span class="line">            &#123;</span><br><span class="line">                id = id == <span class="literal">null</span> ? Guid.NewGuid() : id;</span><br><span class="line">                <span class="keyword">return</span> id;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">set</span></span><br><span class="line">            &#123;</span><br><span class="line">                id = <span class="keyword">value</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        [<span class="meta">Required</span>]</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">string</span> Title &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>对应数据库为<br><img src="https://cdn.jsdelivr.net/gh/w4ngzhen/CDN/images/post/2018-09-13-EF/beforerename.png" alt="beforerename"></p>
<p>此时如果我们想要修改属性名，我们将Book中的Title属性改为Name属性：<br><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">[<span class="meta">Required</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">string</span> Name &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure><br>然后执行Add-Migration命令：<br><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PM&gt; <span class="keyword">add</span>-migration ChangePropName</span><br></pre></td></tr></table></figure><br>我们看到变更类的内容为：<br><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">partial</span> <span class="keyword">class</span> <span class="title">ChangePropName</span> : <span class="title">DbMigration</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Up</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        AddColumn(<span class="string">&quot;dbo.Book&quot;</span>, <span class="string">&quot;Name&quot;</span>, c =&gt; c.String(nullable: <span class="literal">false</span>, unicode: <span class="literal">false</span>));</span><br><span class="line">        DropColumn(<span class="string">&quot;dbo.Book&quot;</span>, <span class="string">&quot;Title&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Down</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        AddColumn(<span class="string">&quot;dbo.Book&quot;</span>, <span class="string">&quot;Title&quot;</span>, c =&gt; c.String(nullable: <span class="literal">false</span>, unicode: <span class="literal">false</span>));</span><br><span class="line">        DropColumn(<span class="string">&quot;dbo.Book&quot;</span>, <span class="string">&quot;Name&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>我们发现，只要更新到数据库，EF会在表中先添加一个字段Name，然后删除字段Title，很显然，这样更新，会将我们现有的数据清空。如何不造成这样的情况呢？其实我们首先知道，在进行Update-database的时候，EF框架会执行Up方法，同时，AddColumn、DropColumn很显然是DbMigration这个类中的方法，我们找一找看有没有重命名的方法呢。令我们欣喜的是，有：<br><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Up</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//AddColumn(&quot;dbo.Book&quot;, &quot;Name&quot;, c =&gt; c.String(nullable: false, unicode: false));</span></span><br><span class="line">    <span class="comment">//DropColumn(&quot;dbo.Book&quot;, &quot;Title&quot;);</span></span><br><span class="line">    RenameColumn(<span class="string">&quot;dbo.Book&quot;</span>, <span class="string">&quot;Title&quot;</span>, <span class="string">&quot;Name&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>注释掉Add和DropColumn，使用RenameColumn，填入表、原字段名、新字段名；接下来我们执行Update-Database -Verbose：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">PM&gt;</span><span class="bash"> UPDATE-DATABASE -VERBOSE</span></span><br><span class="line">...</span><br><span class="line">Fatal error encountered during command execution. ---&gt; MySql.Data.MySqlClient.MySqlException (0x80004005): Parameter &#x27;@columnType&#x27; must be defined.</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>我们发现报了一个错误，实际上解决方法在链接字符串中加入这样一句话“;Allow User Variables=True”就可以了，即如下：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">connectionStrings</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">add</span> <span class="attr">name</span>=<span class="string">&quot;BookDbDemo&quot;</span> <span class="attr">connectionString</span>=<span class="string">&quot;Data Source=localhost; Database=bookdbdemo; User ID=root; Password=;Allow User Variables=True&quot;</span> <span class="attr">providerName</span>=<span class="string">&quot;MySql.Data.MySqlClient&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">connectionStrings</span>&gt;</span></span><br></pre></td></tr></table></figure><br>这样一来，再次运行，不报错。查看数据库：</p>
<p><img src="https://cdn.jsdelivr.net/gh/w4ngzhen/CDN/images/post/2018-09-13-EF/afterrename.png" alt="afterrename"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="w4ngzhen"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">w4ngzhen</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">47</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">44</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/w4ngzhen" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;w4ngzhen" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">w4ngzhen</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

  

</body>
</html>
